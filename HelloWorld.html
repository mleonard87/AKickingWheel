<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Use correct character set. -->
  <meta charset="utf-8">
  <!-- Tell IE to use the latest, best version (or Chrome Frame if pre-IE11). -->
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <title>Hello World!</title>
  <script src="../Build/Cesium/Cesium.js"></script>
  <style>
      @import url(../Build/Cesium/Widgets/widgets.css);

      #cesiumContainer {
          position: absolute;
          top: 0;
          left: 0;
          height: 100%;
          width: 100%;
          margin: 0;
          overflow: hidden;
          padding: 0;
          font-family: sans-serif;
      }

      body {
          padding: 0;
          margin: 0;
          overflow: hidden;
      }
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>
  <script>
    var viewer = new Cesium.Viewer('cesiumContainer');
    var layers = viewer.scene.imageryLayers;
    var rectangle = Cesium.Rectangle.fromDegrees(141.9367,-32.8835, 142.4734, -32.4970)
    var landsat_layer = layers.addImageryProvider(new Cesium.SingleTileImageryProvider({
        url : 'http://eos.ga.gov.au/thredds/wms/LANDSAT/1999/01/LS5_TM_NBAR_P54_GANBAR01-002_095_083_19990125_BX.nc?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&BBOX=141.93675670241285047,-32.88350710976560265,142.47348334450401808,-32.49702248138721927&SRS=EPSG:4326&WIDTH=1036&HEIGHT=746&LAYERS=FalseColour741&STYLES=&FORMAT=image/png&DPI=96&MAP_RESOLUTION=96&FORMAT_OPTIONS=dpi:96&TRANSPARENT=TRUE',
        rectangle : rectangle,
        proxy : new Cesium.DefaultProxy('/proxy/')
    }));
    landsat_layer.show = true;

    // Look at Australia: NE -28.157021, 153.638824. SW -37.505032, 140.999283.
    var west = Cesium.Math.toRadians(108);
    var south = Cesium.Math.toRadians(-37);
    var east = Cesium.Math.toRadians(153);
    var north = Cesium.Math.toRadians(-10);
    var extent = new Cesium.Rectangle(west, south, east, north);
    viewer.scene.camera.viewRectangle(extent, Cesium.Ellipsoid.WGS84);

    // Set time
    viewer.clock.startTime = Cesium.JulianDate.fromIso8601("1995-01-25");
    viewer.clock.currentTime = viewer.clock.startTime;
    viewer.clock.endTime = Cesium.JulianDate.fromIso8601("2005-01-25");
    viewer.clock.multiplier = 100000.0;
    viewer.timeline.updateFromClock();    
    viewer.timeline.zoomTo(viewer.clock.startTime, viewer.clock.stopTime);

    // Listen for time changes to change imagery
    var landsat_time = Cesium.JulianDate.fromIso8601("1999-01-25");

    function timeChanged(event) {
        var now = viewer.clock.currentTime;
        var eps = Math.abs(Cesium.JulianDate.getDaysDifference(landsat_time, now));
        // This governs how fast the image will fade in and out. Higher epsilon = longer fade time.
        eps_test = 200.0;
        var clamped = Cesium.Math.clamp(eps, 0.0, eps_test);
        var normed = clamped/eps_test;
        landsat_layer.alpha = 1 - normed;
    }

    viewer.timeline.addEventListener('settime', function(event) {
        timeChanged(event);
        });

    viewer.clock.onTick.addEventListener(function(event) {
        timeChanged(event);
        });
        
  </script>
</body>
</html>
